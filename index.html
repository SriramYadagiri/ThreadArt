<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thread Art Generator</title>
  <style>
    :root { color-scheme: dark light; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0f17; color:#e8eefc; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px; display: grid; gap: 14px; }
    .top { display: grid; gap: 12px; grid-template-columns: 1.2fr 1fr; }
    @media (max-width: 920px){ .top { grid-template-columns: 1fr; } }

    .card { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: 14px; padding: 14px; }
    .canvasWrap .card { margin: auto }
    .row { display:flex; gap:10px; flex-wrap: wrap; align-items: center; }
    label { font-size: 12px; opacity: 0.9; }
    input[type="number"] { width: 92px; }
    input, button, textarea {
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: inherit;
      padding: 10px 12px;
      font: inherit;
      outline: none;
    }
    button { cursor: pointer; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary { background: rgba(99,102,241,0.25); border-color: rgba(99,102,241,0.55); }
    .btn-ghost { background: transparent; }
    .canvasWrap { display:grid; gap:10px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 920px){ .canvasWrap { grid-template-columns: 1fr; } }
    canvas { height: auto; background: #fff; border-radius: 14px; border: 1px solid rgba(255,255,255,0.12); }
    .muted { opacity: 0.75; font-size: 12px; }
    textarea { width: 95%; min-height: 130px; resize: vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .progress { width: 100%; height: 10px; background: rgba(255,255,255,0.10); border-radius: 999px; overflow: hidden; }
    .bar { height: 100%; width: 0%; background: rgba(99,102,241,0.9); }
    .kv { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .kv > div { display:flex; flex-direction: column; gap:6px; }
    .stepRow { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    input[type="range"] { width: min(520px, 100%); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="card">
        <h2 style="margin:0 0 8px 0;">Thread Art Generator</h2>
        <div class="muted">
          Upload an image → generate thread art → use the viewer to flip through each step (and copy the pin path).
        </div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.10);margin:12px 0;" />

        <div class="row">
          <input id="file" type="file" accept="image/*" />
          <button id="generateBtn" class="btn-primary" disabled>Generate</button>
          <button id="stopBtn" class="btn-ghost" disabled>Stop</button>
        </div>

        <div style="height:10px"></div>

        <div class="kv">
          <div>
            <label>Internal solve size (px) — lower = faster</label>
            <input id="solveSize" type="number" min="160" max="700" step="10" value="450" />
          </div>
          <div>
            <label># Pins</label>
            <input id="pins" type="number" min="30" max="360" step="10" value="180" />
          </div>
          <div>
            <label># Threads (steps)</label>
            <input id="threads" type="number" min="100" max="12000" step="100" value="5000" />
          </div>
          <div>
            <label>String thickness (px)</label>
            <input id="thickness" type="number" min="0" max="5" step="1" value="1" />
          </div>
          <div>
            <label>Optical darkness k (higher = darker)</label>
            <input id="kOptical" type="number" min="0.5" max="6" step="0.1" value="1.6" />
          </div>
        </div>

        <div style="height:20px"></div>
        <div class="progress"><div class="bar" id="bar"></div></div>
        <div class="muted" id="status" style="margin-top:8px;">Upload an image to begin.</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0;">Path</h3>
        <div class="muted">Copy/paste this after generation.</div>
        <div style="height:10px"></div>
        <textarea id="pathOut" placeholder="Path will appear here..."></textarea>
        <div style="height:10px"></div>
        <div class="row">
          <button id="copyBtn" disabled>Copy</button>
          <button id="downloadBtn" disabled>Download JSON</button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.10);margin:24px 0;" />

        <button id="openViewerBtn">Open Viewer</button>

        <br>

        <div class="muted" style="margin-top:10px;">
          Tip: the path array is in pin indices; you can build IRL by following the steps in order.
        </div>
      </div>
    </div>

    <div class="canvasWrap">
      <div class="card">
        <h3 style="margin:0 0 8px 0;">Thread Art</h3>
        <canvas id="threadCanvas" width="500px" height="500px"></canvas>
      </div>
      <div class="card">
        <h3 style="margin:0 0 8px 0;">Image Preview</h3>
        <canvas id="previewCanvas" width="500px" height="500px"></canvas>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>